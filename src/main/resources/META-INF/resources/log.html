<script src="https://unpkg.com/vue@3"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

<style>

    /*Color-Template*/
    .color1 {color: #122933;}
    .color2 {color: #124551;}
    .color3 {color: #12707a;}
    .color4 {color: #17a4ab;}
    .color5 {color: #20dad9;}

    /*Styles for whole website*/
    .headlines{
        margin-top: 2%;
        margin-bottom: 2%;

        color: white;
        text-align: center;
    }
    #header{
        font-size: 2rem;
        color: white;
        text-align: center;
    }
    body{
        background-color: #0C2D48;
    }

    /*Css-Style for PlayerBar*/
    #playerBar {
        height: 92%;
        width: 24%;
        margin: 0.5%;
        float: left;

        background-color: #2E8BC0;
        overflow-x: hidden;
    }
    #singlePlayer {
        height: 20%;
        width: 90%;
        margin: 2.5% auto;

        background-color: #B1D4E0;
        border: 3px solid #0C2D48;
    }
    #playerInfos{
        height: 100%;
        width: 40%;
        float:left;
    }
    .playerInfo {
        height: 20%;
        margin-top: 5%;
        margin-bottom: 5%;

        text-align:center;
    }
    #playerCards{
        height: 100%;
        width: 60%;
        float: right;
    }
    .playerCard {
        height: 75%;
        top: 12.5%;
        width: 40%;
        position: relative;
        margin-right: 5%;
        margin-left: 5%;
    }

    /*Css-Style for MainSection including GameLog, Desk & Pot*/
    #mainSection{
        height: 92%;
        width: 74%;
        margin: 0.5%;
        float: right;

        background-color: #2E8BC0;
    }

    /*Css-Style for GameLog*/
    #gameLog{
        height: 40%;
        width: 95%;
        margin: 1.5% auto;

        background-color: #B1D4E0;
        border: 3px solid #0C2D48;
    }
    .logItems{
        height: 100%;
        width: 50%;
        float:left;

        overflow: auto;
    }
    .logItem {
        max-height: 85%;
        padding-left: 23px;

        list-style-type: none;
        overflow: auto;
    }
    .logHistory{
        width: 50%;
        float: right;

        overflow: auto;
    }

    /*Css-Style for Desk with Deskcards*/
    #desk{
        height: 40%;
        width: 95%;
        margin: 1.5% auto;

        background-color: #B1D4E0;
        border: 3px solid #0C2D48;
    }
    .deskCard{
        margin: 2.5% 1.6%;
        display: flow;
    }

    /*Css-Style for GameLog*/
    #pot{
        height: 10%;
        width: 33%;
        margin: 1.5% auto;

        border: 3px solid #0C2D48;
        text-align: center;
        font-size: 50px;
        color: white;
    }
</style>



<div id="app">

    <header id="header">
        <h1>Poker - Game Table Info (ID: {{ gameId }})</h1>
    </header>

    <aside id="playerBar">
        <h2 class="headlines">Players</h2>

        <section id="singlePlayer" v-for="player in table.players">
            <section id="playerInfos">
                <p class="playerInfo">Name: {{player.name}}</p>
                <p class="playerInfo">Bank: {{player.stack}}</p>
                <p class="playerInfo">Bet: {{player.bet}}</p>
                <p class="playerInfo">Status: {{player.status}}</p>
            </section>

            <section id="playerCards">
                <img class="playerCard" v-for="card in player.cards" :src="getImageUrl(card)" alt="Schrott">
            </section>
        </section>
    </aside>

    <section id="mainSection">
        <section id="gameLog">
            <section class="logItems">
                <h2 class="headlines">Game Log</h2>
                <ul>
                    <li class="logItem" v-for="log in logs">
                        [T{{ log.tableId }}] {{ log.message }}
                    </li>
                </ul>
            </section>
            <section class="logHistory">
                <h2 class="headlines"> Log History</h2>
                <ul>
                    <li class="logItem">Log from table/ round 1</li>
                    <li class="logItem">Log from round 2</li>
                    <li class="logItem">Log from round 3</li>
                    <li class="logItem">Log from round 4</li>
                    <li class="logItem">Log from round 5</li>
                    <li class="logItem">Log from round 6</li>
                </ul>
            </section>
        </section>

        <section id="desk">
            <img class="deskCard" v-for="card in table.communityCards" :src="getImageUrl(card)">
        </section>

        <section>
            <p id="pot">POT: {{table.pot}}</p>
        </section>
    </section>
</div>

<script>

    const {createApp} = Vue

    createApp({
        data() {
            return {
                logs: null,
                gamestate: null,
                score: null,
                gameId: null,
                tableId: null,
                table: null,
            }
        },

        created() {
            this.update();
            this.timer = setInterval(this.update, 1000);
        },
        beforeDestroy() {
            this.cancelAutoUpdate();
        },
        methods: {

            getImageUrl(card){
                if(card.suit && card.rank) {
                    return "Cards/" + card.suit + "/" + this.getCardValue(card.rank) + ".png";
                }
            },
            getCardValue(value){
                switch (value){
                    case "2":
                        return "Two";
                        break;
                    case "3":
                        return "Three";
                        break;
                    case "4":
                        return "Four";
                        break;
                    case "5":
                        return "Five";
                        break;
                    case "6":
                        return "Six";
                        break;
                    case "7":
                        return "Seven";
                        break;
                    case "8":
                        return "Eight";
                        break;
                    case "9":
                        return "Nine";
                        break;
                    case "10":
                        return "Ten";
                        break;
                    case "J":
                        return "Knave";
                        break;
                    case "Q":
                        return "Queen";
                        break;
                    case "K":
                        return "King";
                        break;
                    case "A":
                        return "Ass";
                        break;
                }
            },

            update() {
                // Simple GET request using fetch
                this.gameId = new URL(location.href).searchParams.get('gameId')
                axios
                    .get("/games/" + this.gameId + "/log?order=desc&limit=50")
                    .then(response => {
                        this.logs = response.data;

                        this.tableId = this.logs[this.logs.length-1].tableId;
                    });

                axios
                    .get("/games/" + this.gameId + "/score")
                    .then(response => {
                        let sortable = [];
                        for (var team in response.data) {
                            sortable.push([team, response.data[team]]);
                        }

                        sortable.sort(function (a, b) {
                            return b[1] - a[1];
                        });
                        this.score = sortable;
                    });
                axios
                    .get("/games/" + this.gameId)
                    .then(response => {
                        this.gamestate = response.data;
                    });

                axios
                    .get("/games/"+this.gameId+"/table/"+ this.tableId)
                    .then(response => {
                        this.table = response.data;
                    });
            },
            cancelAutoUpdate() {
                clearInterval(this.timer);
            }
        }
    }).mount('#app')
</script>